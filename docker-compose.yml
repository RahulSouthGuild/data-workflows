services:
  starrocks-fe1:
    image: starrocks/fe-ubuntu:3.3-latest
    hostname: starrocks-fe1
    container_name: starrocks-fe-1
    user: root
    
    entrypoint: /bin/bash
    command:
      - /config/start-fe.sh
      - fe1
    
    environment:
      - JAVA_OPTS=-Xms4096m -Xmx4096m
    
    ports:
      - "8030:8030"
      - "9010:9010"
      - "9030:9030"
    
    networks:
      starrocks_network:
        ipv4_address: 172.25.0.10
    
    volumes:
      - starrocks-fe1-meta:/opt/starrocks/fe/meta
      - starrocks-fe1-log:/opt/starrocks/fe/log
      - ./config:/config:ro
    
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8030/api/bootstrap"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 30s
    
    restart: unless-stopped

  starrocks-fe2:
    image: starrocks/fe-ubuntu:3.3-latest
    hostname: starrocks-fe2
    container_name: starrocks-fe-2
    user: root
    
    entrypoint: /bin/bash
    command:
      - /config/start-fe.sh
      - fe2
    
    environment:
      - JAVA_OPTS=-Xms4096m -Xmx4096m
    
    ports:
      - "8031:8030"
      - "9011:9010"
      - "9031:9030"
    
    networks:
      starrocks_network:
        ipv4_address: 172.25.0.11
    
    volumes:
      - starrocks-fe2-meta:/opt/starrocks/fe/meta
      - starrocks-fe2-log:/opt/starrocks/fe/log
      - ./config:/config:ro
    
    depends_on:
      starrocks-fe1:
        condition: service_healthy
    
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8030/api/bootstrap"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 30s
    
    restart: unless-stopped

  starrocks-be1:
    image: starrocks/be-ubuntu:3.3-latest
    hostname: starrocks-be1
    container_name: starrocks-be-1
    user: root
    
    entrypoint: /bin/bash
    command:
      - /config/start-be.sh
      - starrocks-be1
      - "35"
      - starrocks-fe1
      - "9030"
      - be1
    
    environment:
      - JAVA_OPTS=-Xms2048m -Xmx2048m
    
    ports:
      - "8040:8040"
      - "9050:9050"
      - "9060:9060"
    
    networks:
      starrocks_network:
        ipv4_address: 172.25.0.20
    
    volumes:
      - starrocks-be1-storage:/opt/starrocks/be/storage
      - starrocks-be1-log:/opt/starrocks/be/log
      - ./config:/config:ro
    
    depends_on:
      starrocks-fe1:
        condition: service_healthy
    
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8040/api/health"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 60s
    
    restart: unless-stopped

  starrocks-be2:
    image: starrocks/be-ubuntu:3.3-latest
    hostname: starrocks-be2
    container_name: starrocks-be-2
    user: root
    
    entrypoint: /bin/bash
    command:
      - /config/start-be.sh
      - starrocks-be2
      - "40"
      - starrocks-fe1
      - "9030"
      - be2
    
    environment:
      - JAVA_OPTS=-Xms2048m -Xmx2048m
    
    ports:
      - "8041:8040"
      - "9051:9050"
      - "9061:9060"
    
    networks:
      starrocks_network:
        ipv4_address: 172.25.0.21
    
    volumes:
      - starrocks-be2-storage:/opt/starrocks/be/storage
      - starrocks-be2-log:/opt/starrocks/be/log
      - ./config:/config:ro
    
    depends_on:
      starrocks-fe1:
        condition: service_healthy
    
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8040/api/health"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 60s
    
    restart: unless-stopped

  starrocks-be3:
    image: starrocks/be-ubuntu:3.3-latest
    hostname: starrocks-be3
    container_name: starrocks-be-3
    user: root
    
    entrypoint: /bin/bash
    command:
      - /config/start-be.sh
      - starrocks-be3
      - "45"
      - starrocks-fe1
      - "9030"
      - be3
    
    environment:
      - JAVA_OPTS=-Xms2048m -Xmx2048m
    
    ports:
      - "8042:8040"
      - "9052:9050"
      - "9062:9060"
    
    networks:
      starrocks_network:
        ipv4_address: 172.25.0.22
    
    volumes:
      - starrocks-be3-storage:/opt/starrocks/be/storage
      - starrocks-be3-log:/opt/starrocks/be/log
      - ./config:/config:ro
    
    depends_on:
      starrocks-fe1:
        condition: service_healthy
    
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8040/api/health"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 60s
    
    restart: unless-stopped

  starrocks-be4:
    image: starrocks/be-ubuntu:3.3-latest
    hostname: starrocks-be4
    container_name: starrocks-be-4
    user: root
    
    entrypoint: /bin/bash
    command:
      - /config/start-be.sh
      - starrocks-be4
      - "50"
      - starrocks-fe1
      - "9030"
      - be4
    
    environment:
      - JAVA_OPTS=-Xms2048m -Xmx2048m
    
    ports:
      - "8043:8040"
      - "9053:9050"
      - "9063:9060"
    
    networks:
      starrocks_network:
        ipv4_address: 172.25.0.23
    
    volumes:
      - starrocks-be4-storage:/opt/starrocks/be/storage
      - starrocks-be4-log:/opt/starrocks/be/log
      - ./config:/config:ro
    
    depends_on:
      starrocks-fe1:
        condition: service_healthy
    
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8040/api/health"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 60s
    
    restart: unless-stopped

volumes:
  # Frontend Volumes
  starrocks-fe1-meta:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: /var/lib/docker/starrocks-volumes/fe1-meta
  
  starrocks-fe1-log:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: /var/lib/docker/starrocks-volumes/fe1-log
  
  starrocks-fe2-meta:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: /var/lib/docker/starrocks-volumes/fe2-meta
  
  starrocks-fe2-log:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: /var/lib/docker/starrocks-volumes/fe2-log
  
  # Backend Volumes
  starrocks-be1-storage:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: /var/lib/docker/starrocks-volumes/be1-storage
  
  starrocks-be1-log:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: /var/lib/docker/starrocks-volumes/be1-log
  
  starrocks-be2-storage:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: /var/lib/docker/starrocks-volumes/be2-storage
  
  starrocks-be2-log:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: /var/lib/docker/starrocks-volumes/be2-log
  
  starrocks-be3-storage:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: /var/lib/docker/starrocks-volumes/be3-storage
  
  starrocks-be3-log:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: /var/lib/docker/starrocks-volumes/be3-log
  
  starrocks-be4-storage:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: /var/lib/docker/starrocks-volumes/be4-storage
  
  starrocks-be4-log:
    driver: local
    driver_opts:
      type: none
      o: bind
      device: /var/lib/docker/starrocks-volumes/be4-log

networks:
  starrocks_network:
    driver: bridge
    ipam:
      config:
        - subnet: 172.25.0.0/24
